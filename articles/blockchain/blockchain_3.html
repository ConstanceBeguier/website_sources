<h1>Côté mineur: La validation des transaction</h1>

<h4>Un réseau pair-à-pair (peer-to-peer)</h4>

<p>Un réseau pair-à-pair P2P est un réseau distribué dans lequel chaque noeur a le même rôle. Pour envoyer un message dans un réseau P2P, un noeud envoie le message à tous ses voisins qui eux mêmes renvoient le message à tous leurs voisins et ainsi de suite.</p>

<div class="text-center">
<img src="../../img/blockchain/p2p.png" style="max-width:50%;" class="img-fluid" alt="p2p">
</div>

<p>Nakamoto décire le réseau blockcahin <cite>[Nak08]</cite> comme suit:</p>
<ol>
	<li> Les nouvelles transactions sont envoyées à tous les noeuds.</li>
	<li> Chaque noeud regroupe les transactions dans un bloc.</li>
	<li> Chaque noeud essaie de résoudre une preuve-de-travail (proof-of-work) difficile pour ses blocs.</li>
	<li> Quand un noeud résoud une preuve-de-travail, il envoie son bloc à tous les autre noeuds.</li>
	<li> Les noeuds acceptent le bloc uniquement si toutes les transactions sont valuides and ne sont déjà dépensées.</li>
	<li> Les noeuds expriment leur acceptation du bloc en travaillant à la création du prochain bloc dans la chaine, en utilisant le hash du bloc accepté en tant que hash du bloc précédent.</li>
</ol>
</p>

<p>Les noeuds qui crée et envoie les nouveaux blocs sont appelés des mineurs (en référence aux chercheurs d'or). Ils doivent travailler pour construire un nouveau bloc valide en résolvant un puzzle appelé preuve-de-travail (proof-of-work) et ils sont rémunérés pour faire cela (ils reçoivent un montant en bitcoins pour chaque bloc créé).</p>

<h4>Preuve-de-travail (proof-of-work)</h4>

<p>La preuve-de-travail est un algorithme de consensus utilisé dans la plupart des blockchains. C'est un puzzle ayant les propriétés suivantes:
<ul>
	<li> il est difficile de trouver une solution à ce puzzle</li>
	<li> il est facile de vérifier qu'une solution est valide</li>
</ul>

<p>Dans Bitcoin, la preuve-de-travail est Hashcash. Ce puzzle consiste à trouver un nonce tel que les premiers k bits du hachage du bloc sont égaux à 0.</p>

<div class="text-center">
<img src="../../img/blockchain/PoW.png" style="max-width:50%;" class="img-fluid" alt="PoW">
</div>

<p>Le mineur va essayer successivement des nonces aléatoires jusqu'à ce qu'il trouve un nonce qui résoud ce puzzle. Il va alors envoyer le nouveau bloc contenant ce nonce.</p>

<p>Dans bitcoin, la difficulté de cette preuve-de-travail est ré-ajustée périodiquement afin d'avoir en moyenne un bloc toutes les dix minutes. Pour cela, le nombre de 0 demandés au début du hash du bloc est modifié.</p>

<p>Il est facile de vérifier qu'une solution est valide car un hash est facile est caculé. Mais ce puzzle est difficile à cause de la résistance des fonctions de hachage à la pré-image partielle. </p>

<h4>Fork</h4>

<p>Parfois deux blocs sont créés quasiment en même temps par deux mineurs différents. Chaque mineur va envoyer son nouveau bloc au réseau. Chaque noeud va choisir l'un de ces deux blocs et essayer miner à partir de ce bloc. C'est un fork, la blockchain a maintenant deux branches.</p>

<div class="text-center">
<img src="../../img/blockchain/fork.png" class="img-fluid" alt="fork">
</div>

<p>Le protocole blockchain détermine que la branche légitime est la branche la plus longue. Rapidement, une branche va devenir plus longue que l'autre de plusieurs blocs. Tous les mineurs vont alors abandonner la branche la plus courte car le minage sur une orpheline branche n'est pas valide. Il y a un fork en moyenne tous les 50 blocs dans la blockchain. La plupart des forks se résolvent en seulement un bloc.</p>

<h3>Références</h3>

<p>
[Nak08] Satoshi Nakamoto. Bitcoin: A peer-to-peer electronic cash system. 2008.
</p>

