<h1>Miner side: The validation of transactions</h1>

<h2>The peer-to-peer blockchain network</h2>

<p>A peer-to-peer P2P network is a distributed network in which each node has the same role. To broadcast data into a P2P network, a node sends data to all its neighbor nodes and they will then send data to all their neighbor nodes and so on.</p>

<div class="text-center">
<img src="../../img/blockchain/p2p.png" style="max-width:50%;" class="img-fluid" alt="p2p">
</div>

<p>Nakamoto describes the blockchain network <cite>[Nak08]</cite> as following:</p>
<ol>
	<li> New transactions are broadcast to all nodes.</li>
	<li> Each node collects new transactions into a block.</li>
	<li> Each node works on finding a difficult proof-of-work for its block.</li>
	<li> When a node finds a proof-of-work, it broadcasts the block to all nodes.</li>
	<li> Nodes accept the block only if all transactions in it are valid and not already spent.</li>
	<li> Nodes express their acceptance of the block by working on creating the next block in the chain, using the hash of the accepted block as the previous hash.</li>
</ol>
</p>

<p>The nodes who create and broadcast the new blocks are called miner (in reference to gold digger). They have to work to build a valid new block by resolving a puzzle called proof-of-work and they are rewarded to do that (they receive a small amount of cryptocurrencies for each created valid new block).</p>

<h2>Proof-of-work</h2>

<p>Proof-of-work is a consensus algorithm used in most blockchains. It is a puzzle with the following properties:
<ul>
	<li> it is difficult to find a solution to this puzzle</li>
	<li> it is easy to check that a solution is valid</li>
</ul>

<p>In Bitcoin, the proof-of-work puzzle is Hashcash. This puzzle consists of finding a nonce such as the first k bits of the block hash are 0.</p>

<div class="text-center">
<img src="../../img/blockchain/PoW.png" style="max-width:50%;" class="img-fluid" alt="PoW">
</div>

<p>The miner will try successively random nonces until he finds one which solves this puzzle. He will then send the new block containing this nonce.</p>

<p>In bitcoin, the difficulties of this proof-of-work puzzle is periodically adjusted to have a new block every ten minutes. To do that, they modified the number of 0 targeted at the beginning of the block hash.</p>

<p>It is easy to check that a solution is valid because a hash is easy to compute. But this puzzle is hard to solve because of partial pre-image resistance of hash functions. </p>

<h2>Fork</h2>

<p>Sometimes two blocks are created almost simultaneously by two different miners. Each miner will broadcast his new block to the network. Each node will choose one of these two blocks and try to mine from this selected block. It is called a fork, the blockchain has now two branches.</p>

<div class="text-center">
<img src="../../img/blockchain/fork.png" class="img-fluid" alt="fork">
</div>

<p>The blockchain protocol determines that the legitimate branch is the longest one. Quickly, one branch will be longer of several blocks than the other. All miners will discard the smallest branch because the mining rewards on an orphean branch are not valid. There is a fork on average every 50 blocks in the blockchain. Most forks are resolved in just one block.</p>

<h3>References</h3>

<p>
[Nak08] Satoshi Nakamoto. Bitcoin: A peer-to-peer electronic cash system. 2008.
</p>

